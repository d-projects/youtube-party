
<%- include ('./partials/header') %>
<%- include ('./partials/nav') %>

<div class="bg"></div>


<!-- Masthead -->
<header class="masthead text-white text-center h-100 bg">
  <div class="container">

      <div class="row align-items-center" style="height: 95vh">

        <div class = "col-8 mx-auto alert alert-warning warning-msg d-none">
        </div>

        <div class="col-md-8 mx-auto search">

        <form id="joinForm">
          <div class="form-row">
            <div class="col-8 col-md-5 mb-2 mb-md-0">
              <input type="text" name="room" class="form-control form-control-lg" placeholder="Enter a room id..." required>
            </div>
            <div class="col-8 col-md-3">
              <button type="submit" class="btn btn-block btn-lg btn-primary join">Join a Room</button>
            </div>
          </div>
        </form>

        <br>
        <form id="startForm">
          <div class="form-row">
            <div class="col-12 col-md-9 mb-2 mb-md-0">
              <input type="text" name="url" class="form-control form-control-lg" placeholder="Enter a youtube video url..." required>
            </div>
            <div class="col-12 col-md-3">
              <button type="submit" class="btn btn-block btn-lg btn-success start">Create a Room</button>
            </div>
          </div>
        </form>

      </div>
    </div>
  </div>
</header>

<div class="modal" id="nameModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Your Name</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form action="/watch" method="POST">
          <div class="form-group w-75">
            <label for="name">Please Enter Your Name:</label>
            <input type="text" name="name" class="form-control" id="name" minlength="2">
            <input type="hidden" name="room" class="form-control" id="room" minlength="2">
            <input type="hidden" name="url" class="form-control" id="url" minlength="2">
          </div>
          <button type="submit" class="btn btn-primary">Proceed</button>
      </form>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<script>
document.querySelector('#joinForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const room = e.target.room.value;
  const warningMsg = document.querySelector('.warning-msg');

  fetch('/checkRoom?room='+room)
  .then (result => result.json())
  .then( response => {
    if (response === 'Valid') {
      $('#nameModal').modal('show');
      $('#nameModal').find('#name').focus();
      $('#room').val(room);
      $('#url').val('');
    } else {
      throw new Error('Please enter a valid room ID');
    }
    if (!warningMsg.classList.contains('d-none')){
      warningMsg.classList.add('d-none');
    }
  })
  .catch( err => {
    warningMsg.classList.remove('d-none');
    warningMsg.innerHTML = `<h4> ${err} </h4>`;
  })

});

document.querySelector('#startForm').addEventListener('submit', (e) => {
  e.preventDefault();
  const url = e.target.url.value;
  console.log(url)
  const warningMsg = document.querySelector('.warning-msg');

  fetch('/checkURL?url='+url)
  .then (result => result.json())
  .then( response => {
    if (response === 'Valid') {
      $('#nameModal').modal('show');
      $('#nameModal').find('#name').focus();
      $('#url').val(url);
      $('#room').val('');
    } else {
      throw new Error(response);
    }
    if (!warningMsg.classList.contains('d-none')){
      warningMsg.classList.add('d-none');
    }
  })
  .catch( err => {
    warningMsg.classList.remove('d-none');
    warningMsg.innerHTML = `<h4> ${err} </h4>`;
  })

});


</script>

<%- include ('./partials/footer') %>